{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Git update layers",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/pull_modules",
            "group": "none",
            "problemMatcher": []
        },
        {
            "label": "HomeAssistant: analyze integrations",
            "type": "shell",
            "command": "python3 ${workspaceFolder}/sources/meta-homeassistant/scripts/parse_requirement.py -v ${input:haVersion} -c n",
            "group": "none",
            "problemMatcher": []
        },
        {
            "label": "HomeAssistant: upgrade integrations",
            "type": "shell",
            "command": "python3 ${workspaceFolder}/scripts/run_ha_upgrades_from_csv.py -v ${input:haVersion}",
            "group": "none",
            "problemMatcher": []
        },
        {
            "label": "Devtool Helper",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/devtool-pypi-helper.sh ${input:devtoolAction} ${input:recipeName} ${input:buildDirectory}",
            "group": "none",
            "problemMatcher": []
        },
        {
            "label": "Auto Upgrade Helper",
            "type": "shell",
            "command": "source ${workspaceFolder}/build/build-${input:buildDirectory}/build/init-build-env &&  ${workspaceFolder}/auto-upgrade-helper/upgrade-helper.py -c ${workspaceFolder}/utils/upgrade-helper.conf ${input:recipeName}",
            "group": "none",
            "problemMatcher": []
        },
        {
            "label": "Rauc Test: qemuarm64-a72",
            "type": "shell",
            "command": "${workspaceFolder}/tests/rauc-test.sh qemuarm64-a72",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Rauc Test: qemux86-64n",
            "type": "shell",
            "command": "${workspaceFolder}/tests/rauc-test.sh qemux86-64n",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "HomeAssistant Pip Check",
            "type": "shell",
            "command": "${workspaceFolder}/tests/pip-check-test.sh qemux86-64n",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Test HomeAssistant PTest",
            "type": "shell",
            "command": "${workspaceFolder}/tests/ptest-test.sh ${input:recipeName} ${input:bitbakeSetupMachine}",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Test HomeAssistant Layer",
            "type": "shell",
            "command": [
                "clear && source ${workspaceFolder}/build/build-homeassistant/build/init-build-env && bitbake meta-homeassistant-image-ptest-all"
            ],
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Test HomeAssistant Package",
            "type": "shell",
            "command": [
                "clear && source ${workspaceFolder}/build/build-homeassistant/build/init-build-env && bitbake meta-${input:meta-layer}-image-ptest-${input:recipeName}"
            ],
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Initialize Yocto Environment",
            "type": "shell",
            "command": "clear && ${workspaceFolder}/sources/bitbake/bin/bitbake-setup --setting default registry . --setting default top-dir-prefix ../ --setting default top-dir-name meta-sanctum init --non-interactive --source-overrides ${workspaceFolder}/configurations/sanctum-local-overrides.json sanctum ${input:bitbakeSetupConfiguration} machine/${input:bitbakeSetupMachine} distro/${input:bitbakeSetupDistro}",
            "group": "none",
            "problemMatcher": []
        },
        {
            "label": "Build Yocto Target",
            "type": "shell",
            "command": [
                "clear && source ${workspaceFolder}/build/build-${input:bitbakeSetupConfiguration}/build/init-build-env && bitbake-config-build enable-fragment machine/${input:bitbakeSetupMachine} && bitbake-config-build enable-fragment distro/${input:bitbakeSetupDistro} && bitbake -k ${input:buildTarget}"
            ],
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "RunQemu Yocto Target",
            "type": "shell",
            "command": [
                "clear && source ${workspaceFolder}/build/build-${input:bitbakeSetupConfiguration}/build/init-build-env && runqemu tmp/deploy/images/${input:bitbakeSetupMachine}/${input:buildTarget}.qemuboot.conf slirp wic kvm ovmf ${input:graphicalTarget}"
            ],
            "group": "test",
            "problemMatcher": []
        }
    ],
    "inputs": [
        {
            "id": "haVersion",
            "description": "Enter Home Assistant version (comma separated)",
            "type": "promptString"
        },
        {
            "id": "devtoolAction",
            "description": "devtool action (add/finish)",
            "type":"pickString",
            "options": [
                "add",
                "finish",
                "upgrade"
            ],
            "default": "add"
        },
        {
            "id": "buildDirectory",
            "description": "Enter the build directory suffix (e.g., homeassistant)",
            "type": "promptString",
            "default": "homeassistant"
        },
        {
            "id": "recipeName",
            "description": "Enter the Recipe name",
            "type": "promptString"
        },
        {
            "id": "meta-layer",
            "description": "Enter the Layer name",
            "type": "promptString"
        },
        {
            "id": "bitbakeSetupConfiguration",
            "description": "Select the bitbake-setup configuration to use",
            "type":"pickString",
            "options": [
                "homeassistant",
                "sanctum",
                "openembedded-test",
                "gnome-image"
            ],
            "default": "sanctum"
        },
        {
            "id": "bitbakeSetupMachine",
            "description": "Enter the machine name for bitbake-setup",
            "type": "pickString",
            "options": [
                "qemux86-64",
                "qemux86-64n",
                "qemuriscv64",
                "qemuarm64-a72",
            ],
            "default": "qemux86-64n"
        },
        {
            "id": "bitbakeSetupDistro",
            "description": "Enter the distro name for bitbake-setup",
            "type": "pickString",
            "options": [
                "sanctum"
            ],
            "default": "sanctum"
        },
        {
            "id": "buildTarget",
            "description": "Enter the build target",
            "type": "pickString",
            "options": [
                "core-image-homeassistant-full",
                "sanctum-bundle",
                "sanctum-rootfs",
                "sanctum-gnome-image"
            ],
            "default": "sanctum-bundle"
        },
        {
            "id": "graphicalTarget",
            "description": "Select graphical target for runqemu",
            "type":"pickString",
            "options": [
                "nographic",
                "egl-headless publicvnc",
            ],
            "default": "nographic"
        }
    ]
}