# short-description: Create Qemu disk image
# long-description: Creates a partitioned Qemu disk image for use with the RAUC update tool.

bootloader --ptable gpt

# Boot partition
part --fixed-size 50M --source rawcopy --sourceparams="file=sanctum-bootfs.vfat" --fstype=vfat --ondisk vda --label boot --active --align 4096
part --fixed-size 50M --ondisk sda --align 4096 --no-table

# Data storage for persistent data such as grubenv environment
part --fixed-size 50M --source rawcopy --sourceparams="file=sanctum-grubenv.vfat" --fstype=vfat --ondisk vda --label grubenv --align 1024

# Rootfs
part / --fixed-size 2G --source rootfs --ondisk vda --fstype=ext4 --label root_A --align 4096 --exclude-path=data/ 
part / --fixed-size 2G --source empty  --ondisk vda --fstype=ext4 --label root_B --align 4096

part /data --fixed-size 100M --source rootfs --ondisk vda --fstype=ext4 --rootfs-dir=${IMAGE_ROOTFS}/data --label data --align 4096